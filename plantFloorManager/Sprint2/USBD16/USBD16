CREATE OR REPLACE FUNCTION RegisterProduct(
    p_PartID Product.PartID%TYPE,
    p_Name Product.Name%TYPE,
    p_PFID Product.PFID%TYPE,
    p_description Part.Description%TYPE
) RETURN VARCHAR2 IS
    v_error_message VARCHAR2(4000);
    v_exists NUMBER;
BEGIN
    -- Verifica se o produto já existe
    SELECT COUNT(*)
    INTO v_exists
    FROM Product
    WHERE PartID = p_PartID;

    IF v_exists > 0 THEN
        RETURN 'Error: A product with the same PartID already exists.';
    END IF;

    -- Verifica se a família de produtos existe
    SELECT COUNT(*)
    INTO v_exists
    FROM ProductFamily
    WHERE PFID = p_PFID;

    IF v_exists = 0 THEN
        RETURN 'Erro: Família de produtos não encontrada.';
    END IF;

    -- Insere a peça na tabela Part
    INSERT INTO Part (PartID, Description) 
    VALUES (p_PartID, p_description);

    -- Insere o novo produto
    INSERT INTO Product (PartID, Name, PFID)
    VALUES (p_PartID, p_Name, p_PFID);

    -- Confirma a transação
    COMMIT;

    RETURN 'Success: Product ' || p_Name || ' registered successfully with PartID ' || p_PartID;

EXCEPTION
    WHEN OTHERS THEN
        v_error_message := SQLERRM;
        
        -- Reverte a transação em caso de erro
        ROLLBACK;
        
        RETURN 'Error: Unable to register product. Details: ' || v_error_message;
END RegisterProduct;
/


DECLARE
    v_result VARCHAR2(255);
BEGIN
    v_result := RegisterProduct('id', 'nome', 130, 'descriçao');
    DBMS_OUTPUT.PUT_LINE(v_result);
END;
/

SELECT Product.Name, Product.PartID, Product.PFID FROM Product
WHERE Product.PartID = 'id'